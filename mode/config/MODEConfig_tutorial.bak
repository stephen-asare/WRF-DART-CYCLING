////////////////////////////////////////////////////////////////////////////////
// MODE configuration: WRF reflectivity vs MOSAIC radar DBZ
// Save as: MODEConfig_dbz
////////////////////////////////////////////////////////////////////////////////

model  = "WRF";
desc   = "DBZ_object_verif";
obtype = "MOSAIC";

////////////////////////////////////////////////////////////////////////////////
// Verification grid (regrid OBS to FCST grid)
////////////////////////////////////////////////////////////////////////////////
regrid = {
   to_grid    = FCST;
   method     = NEAREST;
   width      = 1;
   vld_thresh = 0.5;
   shape      = SQUARE;
}


grid_res = 3;


quilt = TRUE;

////////////////////////////////////////////////////////////////////////////////
// Forecast field (WRF NetCDF)
////////////////////////////////////////////////////////////////////////////////
// fcst = {
//    // IMPORTANT: MODE expects the *field* description and object settings here.
//    // file_type comes from README (“File types” lives in ConfigConstants).
//    file_type = NETCDF_WRF;

//    // Pick ONE of the following two field-name options:
//    // (A) If you have a 2-D composite reflectivity already in wrfout:
//    //      name="REFL_10CM_MAX" or "DBZ" or whatever the 2-D var is; level="(*,*)"
//    // (B) If you only have 3-D REFL_10CM, select a single level index, e.g. k=0:
//    //      name="REFL_10CM"; level="(0,*,*)"
//    // Prefer (A) for MODE (object-based 2-D).
//    field = {
//       name  = "REFL_10CM";   // <<< change if your 2-D composite var has a different name
//       level = "(*,*)";       // use "(*,*)" for 2-D vars; for 3-D pick an index: "(K,*,*)"
      // level = "(19,0,*,*)";    // (Time index, y*, x*)  <-- IMPORTANT

//    }

//    // Object-definition knobs (defaults from your template, adapted for DBZ)
//    censor_thresh      = [];
//    censor_val         = [];
//    conv_radius        = [ 3, 5 ];                 // grid squares (~9–15 km at 3-km)
//    conv_thresh        = [ >=25.0, >=35.0, >=40.0 ]; // dBZ cutoffs to sweep
//    vld_thresh         = 0.5;

//    // Optional: filter out tiny specks by area or intensity percentiles later
//    filter_attr_name   = [];    // e.g., [ "AREA" ]
//    filter_attr_thresh = [];    // e.g., [ >=9 ]  // 3x3 cells

//    // Merging: double-threshold method with a modest lower floor
//    merge_thresh       = [ >=20.0, >=30.0, >=35.0 ];
//    merge_flag         = THRESH;
// }
fcst = {
  file_type = NETCDF_WRF;

  field = {
   name  = "REFL_10CM";   // 2-D composite reflectivity in dBZ
   level = "(19,0,*,*)"; 
  }

  censor_thresh      = [ <0 ];
  censor_val         = [ 0 ];
  conv_radius        = [ 5];
  conv_thresh        = [ >=25.0];
  vld_thresh         = 0.5;
  filter_attr_name   = [];
  filter_attr_thresh = [];
  merge_thresh       = [ >=1.25 ];
  merge_flag         = THRESH;
}


////////////////////////////////////////////////////////////////////////////////
// Observation field (generic NetCDF mosaic)
////////////////////////////////////////////////////////////////////////////////
obs = {
//   file_type = NETCDF_NCCF;

  field = {
    name  = "REFC_L0";   // from ncdump
    level = "(*,*)";     // 2-D (lat, lon)
  }

  censor_thresh      = [];
  censor_val         = [];
  conv_radius        = [ 5];
  conv_thresh        = [ >=25.0];
  vld_thresh         = 0.5;
  filter_attr_name   = [];
  filter_attr_thresh = [];
  merge_thresh       = [ >=1.25];
  merge_flag         = THRESH;
}


////////////////////////////////////////////////////////////////////////////////
// Missing-data masking (DBZ mosaics sometimes have holes)
////////////////////////////////////////////////////////////////////////////////
mask_missing_flag = BOTH;

////////////////////////////////////////////////////////////////////////////////
// Matching & distance limits (keep your default logic)
////////////////////////////////////////////////////////////////////////////////
match_flag         = MERGE_BOTH;
max_centroid_dist  = 800.0/grid_res;

////////////////////////////////////////////////////////////////////////////////
// Optional geographic masks (left empty = whole domain)
////////////////////////////////////////////////////////////////////////////////
mask = {
   grid      = "";
   grid_flag = NONE; // NONE, FCST, OBS, BOTH
   poly      = "";
   poly_flag = NONE; // NONE, FCST, OBS, BOTH
}

////////////////////////////////////////////////////////////////////////////////
// Fuzzy engine weights and interest functions (unchanged from your default)
////////////////////////////////////////////////////////////////////////////////
weight = {
   centroid_dist    = 2.0;
   boundary_dist    = 4.0;
   convex_hull_dist = 0.0;
   angle_diff       = 1.0;
   aspect_diff      = 0.0;
   area_ratio       = 1.0;
   int_area_ratio   = 2.0;
   curvature_ratio  = 0.0;
   complexity_ratio = 0.0;
   inten_perc_ratio = 0.0;
   inten_perc_value = 50;
}

interest_function = {
   centroid_dist = (
      (            0.0, 1.0 )
      (  60.0/grid_res, 1.0 )
      ( 600.0/grid_res, 0.0 )
   );
   boundary_dist = (
      (            0.0, 1.0 )
      ( 400.0/grid_res, 0.0 )
   );
   convex_hull_dist = (
      (            0.0, 1.0 )
      ( 400.0/grid_res, 0.0 )
   );
   angle_diff = (
      (  0.0, 1.0 )
      ( 30.0, 1.0 )
      ( 90.0, 0.0 )
   );
   aspect_diff = (
      (  0.00, 1.0 )
      (  0.10, 1.0 )
      (  0.75, 0.0 )
   );
   corner   = 0.8;
   ratio_if = (
      (    0.0, 0.0 )
      ( corner, 1.0 )
      (    1.0, 1.0 )
   );
   area_ratio = ratio_if;
   int_area_ratio = (
      ( 0.00, 0.00 )
      ( 0.10, 0.50 )
      ( 0.25, 1.00 )
      ( 1.00, 1.00 )
   );
   curvature_ratio = ratio_if;
   complexity_ratio = ratio_if;
   inten_perc_ratio = ratio_if;
}

total_interest_thresh  = 0.7;
print_interest_thresh  = 0.0;

////////////////////////////////////////////////////////////////////////////////
// Plot & output flags (kept consistent with your default)
////////////////////////////////////////////////////////////////////////////////
met_data_dir = "MET_BASE";

fcst_raw_plot = {
   color_table      = "MET_BASE/colortables/met_default.ctable";
   plot_min         = 0.0;
   plot_max         = 0.0;
   colorbar_spacing = 1;
}

obs_raw_plot = {
   color_table      = "MET_BASE/colortables/met_default.ctable";
   plot_min         = 0.0;
   plot_max         = 0.0;
   colorbar_spacing = 1;
}

object_plot = {
   color_table      = "MET_BASE/colortables/mode_obj.ctable";
}

plot_valid_flag = FALSE;
plot_gcarc_flag = FALSE;

ps_plot_flag  = TRUE;
nc_pairs_flag = {
   latlon       = TRUE;
   raw          = TRUE;
   object_raw   = TRUE;
   object_id    = TRUE;
   cluster_id   = TRUE;
   polylines    = TRUE;
}
ct_stats_flag = TRUE;

shift_right   = 0;
output_prefix = "";
version       = "V12.1.1";   
